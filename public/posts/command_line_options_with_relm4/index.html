<!DOCTYPE html>
<html class="" lang="en-us"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    
        <script>
            if (location.host != new URL("http:\/\/localhost:1313\/").host) location.href = "http:\/\/localhost:1313\/"
        </script>
    
    <meta name="robots" content="noai, noimageai">
    <meta name="viewport" content="width=device-width" />
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=7" />

    <link
    rel="icon"
    href='/favicon.png'
/>
<link
    rel="shortcut icon"
    href='/favicon.ico'
    type="image/x-icon"
/>
<link
    rel="apple-touch-icon"
    href='/apple-touch-icon.png'
/>

    <link
        rel="icon"
        href='/logo.svg'
        type="image/svg+xml"
    />

<title>
        
            Command line options with Relm4  &ndash;
        
        RIRSC
    </title>

    
    <link href="/symbols-nerd-font/symbols-nerd-font.css" rel="stylesheet" integrity="sha512-lydow8GLOLlYNOtHlksNCmGWWCBsbIEtikXpHzfWqx78HLlyQZHOzyLwPpKol4Th6aCwLUXOfODVYgwrd3nwKQ=="/>
    <link href="/jetbrains-mono/jetbrains-mono.css" rel="stylesheet" integrity="sha512-tJxlgL6v1Y7kFf+qB8SloaAMKnOAw6WouknxXtIjkBux9Y/9aX81EUWOJO8c/3l98DmjG8brr4to7zaez606Fg=="/>

    
    
    <link type="text/css" rel="stylesheet" href=http://localhost:1313/css/styles.abbd6311bb4b6ca58f8e7398140529245ae0f6428b759fcd830742eee2619eabb900ba9914a9affb82aa9a16a9b9ea727bb315315a976a0db0e7513a5f12c504.css integrity="sha512-q71jEbtLbKWPjnOYFAUpJFrg9kKLdZ/NgwdC7uJhnqu5ALqZFKmv&#43;4Kqmhapuepye7MVMVqXag2w51E6XxLFBA==" />
<meta name="author" content="Ricardo López" />

    
        <meta name="keywords" content='gtk, gtk4, relm4, rust, terminal' />
    
    
        <meta name="description" content="g Relm4 for a project and it&amp;rsquo;s been pretty great. Relm4 is basically a wrapper around the GTK API that offers a more declarative layer of abstraction for building applications." />
    

<meta property="og:site_name"
    content='RIRSC' />

    <meta property="og:title" content="Command line options with Relm4" />
    <meta property="og:type" content="article" />
    
    <meta
        property="article:author" content="Ricardo López" />
    <meta
        property="article:published_time"
        content='2024-02-07T07:32:14Z&#43;0100' />
    
        
            <meta property="article:tag" content="gtk" />
        
            <meta property="article:tag" content="gtk4" />
        
            <meta property="article:tag" content="relm4" />
        
            <meta property="article:tag" content="rust" />
        
            <meta property="article:tag" content="terminal" />
        
    
    <meta property="og:url" content="http://localhost:1313/posts/command_line_options_with_relm4/" />
    
    
    <meta property="og:image"
        content="http://localhost:1313/android-chrome-512x512.png" />
    
        <meta property="og:description" content="I&amp;rsquo;ve been using Relm4 for a project and it&amp;rsquo;s been pretty great. Relm4 is basically a wrapper around the GTK API that offers a more declarative layer" />
    

<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:domain"
      content='localhost:1313'
/>
<meta property="twitter:url" content="http://localhost:1313/posts/command_line_options_with_relm4/" />


    <meta name="twitter:title" content="Command line options with Relm4" />
    
    
    
    <meta name="twitter:image"
        content="http://localhost:1313/android-chrome-512x512.png" />
    
        <meta name="twitter:description" content="I&amp;rsquo;ve been using Relm4 for a project and it&amp;rsquo;s been pretty great. Relm4 is basically a wrapper around the GTK API that offers a more declarative layer" />
    

<link rel="manifest" href="/manifest/index.json" />
</head>


<body>
        <div id="baseContainer"><header class="">
<div class="titleAndSearchContainer">
        <div id="titleContainer">
            
                <a class="unstyledLink" href="/">
                    <img src='/logo.svg' alt='Logo'/>
                </a>
            
            <div class="rightOfLogo">
                <div class="titleAndHamburger">
                    <h1>
                        <a class="unstyledLink" href="/">RIRSC</a>
                        
                    </h1>
                    
                </div>
                <div id="wide_nav"><nav>
    
    <ul id="main-nav">
        <li><a href="/">Home</a></li>
        
            <li><a href="/posts/">Posts</a></li>
        
        
        
        
        
            <li><a href="http://localhost:1313/pages/about/">
                About
            </a></li>
        
        
            <li><a href="/archguide">Arch guide</a></li>
        
        
            <li><a href="/tags/">Tags</a></li>
        
        
    </ul>
</nav>
</div>
            </div>
        </div>
        <div class="search">
    <input id="searchbar" type="text" placeholder='Search' />
    <span class="nerdlink" onclick="newSearch();">&#xf002;</span>
</div>
<script>
    function newSearch() {
        let term = searchbar.value.trim();
        if (!term) return;
        location.href = `/search/?q=${term}`;
    }
    searchbar.onkeyup = (ev) => {if (ev.keyCode == 13) newSearch()};
</script>

    </div>
    <div id="links">
        <a
    
        rel="noreferrer"
    
    target="_blank"
    class="nerdlink"
    href="/index.xml">
    
    
        &#xf09e;
    
    <span>
        RSS
    </span>
</a>

        
        <a
    
        rel="noreferrer"
    
    target="_blank"
    class="nerdlink"
    href="https://gitlab.com/gabmus">
    
    
        &#xf296;
    
    <span>
        GitLab
    </span>
</a>
<a
    
        rel="noreferrer"
    
    target="_blank"
    class="nerdlink"
    href="https://gitlab.gnome.org/gabmus">
    
    
        &#xf7ab;
    
    <span>
        GNOME GitLab
    </span>
</a>
<a
    
        rel="noreferrer"
    
    target="_blank"
    class="nerdlink"
    href="https://youtube.com/TechPillsNet">
    
    
        &#xf16a;
    
    <span>
        YouTube
    </span>
</a>
<a
    
        rel="me"
    
    target="_blank"
    class="nerdlink"
    href="https://fosstodon.org/@gabmus">
    
    
        <svg class='pseudofont' xmlns:svg='http://www.w3.org/2000/svg' width='16' height='16' viewbox='0 0 16 16'><path d='M 7.4779094,-1.598624e-6 C 5.5602384,0.0156984 3.7155894,0.2233384 2.6405814,0.7170384 c 0,0 -2.13206093,0.9537 -2.13206093,4.20766 0,0.74512 -0.01448,1.63603 0.0091,2.58084 0.07742,3.1821946 0.58336693,6.3183886 3.52553593,7.0971276 1.356568,0.359063 2.521335,0.434289 3.45936,0.382729 1.701085,-0.09431 2.6560206,-0.607063 2.6560206,-0.607063 l -0.05611,-1.234252 c 0,0 -1.2156316,0.383272 -2.5808476,0.33656 -1.352609,-0.04639 -2.780561,-0.145832 -2.999328,-1.80651 -0.0202,-0.145872 -0.03031,-0.301902 -0.03031,-0.465714 0,-10e-7 1.327834,0.324572 3.010574,0.40167 1.028943,0.0472 1.993827,-0.06028 2.9738766,-0.177218 1.879445,-0.224425 3.515901,-1.382448 3.721577,-2.4405646 0.32407,-1.666815 0.297376,-4.067605 0.297376,-4.067605 0,-3.25396 -2.131943,-4.20766 -2.131943,-4.20766 C 11.288476,0.2233384 9.4426784,0.0156784 7.5250084,-1.598624e-6 Z M 5.3076104,2.5424984 c 0.798781,0 1.403595,0.30701 1.803551,0.92113 l 0.388886,0.65181 0.388884,-0.65181 c 0.399875,-0.61412 1.00469,-0.92113 1.803551,-0.92113 0.6903266,0 1.2465526,0.24267 1.6713186,0.71609 0.411755,0.47342 0.61677,1.11337 0.61677,1.91862 v 3.939988 h -1.560986 v -3.824218 c 0,-0.80613 -0.339166,-1.21531 -1.0176126,-1.21531 -0.750129,0 -1.126049,0.48533 -1.126049,1.44509 v 2.09324 h -1.551753 v -2.09324 c 0,-0.95976 -0.376039,-1.44509 -1.126168,-1.44509 -0.678446,0 -1.017613,0.40918 -1.017613,1.21531 v 3.824218 h -1.560985 v -3.939988 c 0,-0.80525 0.205053,-1.4452 0.616889,-1.91862 0.424685,-0.47342 0.980911,-0.71609 1.671317,-0.71609 z' /></svg>
    
    <span>
        Mastodon
    </span>
</a>

    </div>
    

</header>
<div id="contentContainer">
                <div id="content">
                    <main>
<article class="card single">
    
        <h1>Command line options with Relm4</h1>
    
    
        <p class="date">
            <span title='Date'> </span>
    2024-02-07

</p>
    
    
    
    
    <div><p>I&rsquo;ve been using <a href="https://relm4.org/">Relm4</a> for a project and it&rsquo;s been pretty great. Relm4 is basically a wrapper around the GTK API that offers a more declarative layer of abstraction for building applications.</p>
<p>The only problem I find is that the project seems a little bit niche. Don&rsquo;t get me wrong, it seems very polished and so far I haven&rsquo;t found any bugs, so that&rsquo;s exceptional considering the scope of the project. The real problem with it being niche is that of course not every use case can be fully covered and documented, so some stuff you just have to figure out for yourself.</p>
<p>This was the case for me with command line options.</p>
<p>You might know that GTK offers a way to manage command line options out of the box, but Relm4 simply doesn&rsquo;t wrap that particular API. After a bit of research I found a good way to make it all work and here&rsquo;s how.</p>
<p>So given a struct named <code>MyAppComponent</code> being your root Relm4 component:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-rust" data-lang="rust"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> app <span style="color:#ff79c6">=</span> gtk4::Application::builder()
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// set other properties as needed...
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    .flags(gtk4::gio::ApplicationFlags::HANDLES_COMMAND_LINE)
</span></span><span style="display:flex;"><span>    .build();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// don&#39;t know if this really MUST be static, but that&#39;s what works for me
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span><span style="color:#ff79c6">static</span> BROKER: <span style="color:#50fa7b">relm4</span>::MessageBroker<span style="color:#ff79c6">&lt;</span>MyAppComponent::Input<span style="color:#ff79c6">&gt;</span> <span style="color:#ff79c6">=</span> relm4::MessageBroker::new();
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// this is just an example, here&#39;s the documentation for the Gio.Application API
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">// https://docs.gtk.org/gio/method.Application.add_main_option.html
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>app.add_main_option(
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;foo&#34;</span>,
</span></span><span style="display:flex;"><span>    gtk4::glib::Char::try_from(<span style="color:#f1fa8c">&#39;f&#39;</span>).unwrap(),
</span></span><span style="display:flex;"><span>    gtk4::glib::OptionFlags::IN_MAIN,
</span></span><span style="display:flex;"><span>    gtk4::glib::OptionArg::<span style="color:#8be9fd;font-style:italic">None</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f1fa8c">&#34;foo option description here&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">None</span>
</span></span><span style="display:flex;"><span>);
</span></span><span style="display:flex;"><span><span style="color:#6272a4">// add as many options as you want
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> sender <span style="color:#ff79c6">=</span> BROKER.sender(); <span style="color:#6272a4">// we&#39;ll move this to the signal handler below
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>app.connect_command_line(<span style="color:#ff79c6">move</span> <span style="color:#ff79c6">|</span>this, cmdline<span style="color:#ff79c6">|</span> {
</span></span><span style="display:flex;"><span>    this.activate();
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// very basic example, what I actually did was parse the
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#6272a4">// ApplicationCommandLine object and save my flags in an ad-hoc struct
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    <span style="color:#6272a4">// but this should also just work
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>    sender.emit(MyAppComponent::Input::HandleCommandLine(cmdline));
</span></span><span style="display:flex;"><span>    <span style="color:#bd93f9">0</span>
</span></span><span style="display:flex;"><span>});
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">let</span> relm_app <span style="color:#ff79c6">=</span> relm4::RelmApp::from_app(app).with_broker(<span style="color:#ff79c6">&amp;</span>BROKER);
</span></span><span style="display:flex;"><span>relm_app.run::<span style="color:#ff79c6">&lt;</span>MyAppComponent<span style="color:#ff79c6">&gt;</span>(MyAppComponent::Init {
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// your init data here
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>});
</span></span></code></pre></div><p>All you need now is a handler for the <code>HandleCommandLine</code> input signal in your app component and you&rsquo;re pretty much all set.</p>
<p>This is very much a simplified example of what I&rsquo;m actually doing, but it should serve as a good base to build on top of. Being that this was previously completely undocumented, at least it&rsquo;s a starting point.</p>
<p>Feel free to comment if you have found a better solution or if somehow I missed some critical piece of documentation that explains the actual way to do this.</p>
</div>
</article>

    <hr />
    <p class="articleTagsContainer">
        <span> </span>
        <strong>Tags:</strong>
        
            <a
                
                href="/tags/gtk/">#gtk</a>
        
            <a
                
                href="/tags/gtk4/">#gtk4</a>
        
            <a
                
                href="/tags/relm4/">#relm4</a>
        
            <a
                
                href="/tags/rust/">#rust</a>
        
            <a
                
                href="/tags/terminal/">#terminal</a>
        
    </p>


    <a style="margin-bottom: 24px; display: inline-block;" class="shareBtn" onclick="openFediInstanceDialog();">
        Share on the Fediverse
    </a>
    <div id="fediInstanceDialog">
        <div class="bg" onclick="closeFediInstanceDialog();"></div>
        <div class="dialog">
            <h2>Enter your instance&#39;s address</h2>
            <input id="fediInstanceInput" placeholder='Eg. mastodon.social' type="text" />
            <div class="buttons">
                <a class="shareBtn" onclick="closeFediInstanceDialog();">Cancel</a>
                <a class="shareBtn" onclick="shareOnFedi();">Share</a>
            </div>
        </div>
    </div>
    <script>
        var articleTitle = 'Command line options with Relm4';
        var articleLink = 'http:\/\/localhost:1313\/posts\/command_line_options_with_relm4\/';
        var fediInstanceDialog = document.getElementById('fediInstanceDialog');
        var fediInstanceInput = document.getElementById('fediInstanceInput');
        function openFediInstanceDialog() {
            fediInstanceDialog.classList.add('open');
        }
        function closeFediInstanceDialog() {
            fediInstanceDialog.classList.remove('open');
        }
        function fixURL(url) {
            if (url.substr(0, 8) == 'https://') return url;
            if (url.substr(0, 7) == 'http://') return url;
            return 'https://' + url;
        }
        function shareOnFedi() {
            let instance = fediInstanceInput.value.trim();
            if (!instance) {
                return;
            }
            instance = fixURL(instance);
            window.open(
                `${instance}/share?text=${articleTitle}%20${articleLink}`,
                '__blank'
            );
            closeFediInstanceDialog();
        }
    </script>




    
    
        
        <div class="relatedArticlesContainer">
            <hr />
            <h2>More posts like this</h2>
            <div class="postlist ">
                <article class="card postlistitem">
    <div>
        <h2>
            <a href="http://localhost:1313/posts/swatch_a_color_palette_manager/">Swatch: a color palette manager</a>
        </h2>
        <p class="date">
            <span title='Date'> </span>
    2022-02-14


                | 
                <span title='Tags'> </span>
                
                    <a href="/tags/app">#app</a>
                
                    <a href="/tags/blueprint">#blueprint</a>
                
                    <a href="/tags/color">#color</a>
                
                    <a href="/tags/gtk">#gtk</a>
                
                    <a href="/tags/gtk4">#gtk4</a>
                
                    <a href="/tags/libadwaita">#libadwaita</a>
                
                    <a href="/tags/swatch">#swatch</a>
                
            
        </p>
        
            
                <a class="unstyledLink" href="http://localhost:1313/posts/swatch_a_color_palette_manager/">
                    
                        <img src="/images/post_pics/Swatch_a_color_palette_manager/scrot0.png" alt="" />
                    
                </a>
            
        
        
            <div class="articlePreview">
                <p>
                    
                        Between one thing and the other, I found myself in need for a palette manager: something to let me categorize different palettes and easily pick and name colors depending on their use.
                    
                </p>
                <p><a href="http://localhost:1313/posts/swatch_a_color_palette_manager/">Continue reading </a></p>
            </div>
        
    </div>
    <hr />
</article>
<article class="card postlistitem">
    <div>
        <h2>
            <a href="http://localhost:1313/posts/block_ads_in_webkitgtk/">Block ads in WebKitGtk</a>
        </h2>
        <p class="date">
            <span title='Date'> </span>
    2021-11-27


                | 
                <span title='Tags'> </span>
                
                    <a href="/tags/adblock">#adblock</a>
                
                    <a href="/tags/gtk">#gtk</a>
                
                    <a href="/tags/python">#python</a>
                
                    <a href="/tags/tutorial">#tutorial</a>
                
                    <a href="/tags/webkit">#webkit</a>
                
                    <a href="/tags/webkit2gtk">#webkit2gtk</a>
                
                    <a href="/tags/webkitgtk">#webkitgtk</a>
                
                    <a href="/tags/webview">#webview</a>
                
            
        </p>
        
            
                <a class="unstyledLink" href="http://localhost:1313/posts/block_ads_in_webkitgtk/">
                    
                        <img src="/images/post_pics/Block_ads_in_WebKitGtk/block_ads_webkit.avif" alt="" />
                    
                </a>
            
        
        
            <div class="articlePreview">
                <p>
                    
                        One of the most requested features (and for a good reason) in Feeds has always been ad blocking.
I never came around to implement it, mostly because I couldn&rsquo;t find a guide or any similar resource, except for GNOME Web&rsquo;s source code, and that&rsquo;s not exactly easy to navigate.
                    
                </p>
                <p><a href="http://localhost:1313/posts/block_ads_in_webkitgtk/">Continue reading </a></p>
            </div>
        
    </div>
    <hr />
</article>

            </div>
        </div>
    


                    </main><footer>
    <hr />

<p><small>
        2024 &copy; Ricardo López - <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
    </small></p>
    <p><small>
        <a href='https://gitlab.com/gabmus/hugo-ficurinia'>Ficurinia theme</a> for <a href='https://gohugo.io'>Hugo</a> by <a href='https://gabmus.org'>Gabriele Musco</a>. Licensed under <a href='https://www.gnu.org/licenses/agpl-3.0.html'>GNU AGPLv3</a>.
    </small></p>
</footer>
</div>
            </div>
        </div>


</body>
</html>
