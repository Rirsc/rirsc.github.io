<?xml version="1.0" encoding="utf-8" standalone="yes"?><?xml-stylesheet href="/feed_style.xsl" type="text/xsl"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:media="https://www.rssboard.org/media-rss">
  <channel>
    <title>Area on RIRSC</title>
    <link>http://localhost:1313/tags/area/</link>
    <description>Recent content in Area on RIRSC</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <copyright>Ricardo LÃ³pez</copyright>
    <lastBuildDate>Sat, 03 Oct 2020 10:23:54 +0200</lastBuildDate><atom:link href="http://localhost:1313/tags/area/index.xml" rel="self" type="application/rss+xml" /><icon>http://localhost:1313/Rirsc_Logo.svg</icon>
    
    
    <item>
      <title>Create an auto resizing image widget with GTK3 and Python</title>
      <link>http://localhost:1313/posts/create_an_auto-resizing_image_widget_with_gtk3_and_python/</link>
      <pubDate>Sat, 03 Oct 2020 10:23:54 +0200</pubDate>
      
      <guid>http://localhost:1313/posts/create_an_auto-resizing_image_widget_with_gtk3_and_python/</guid>
      <description><![CDATA[<p>One of the most common things you might wanna do with images, that is making them automatically resize to adapt to the available space they have, is not possible with <code>Gtk.Image</code>.</p>
<p>So after some hacking, I seem to have found a solution that works:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">from</span> gi.repository <span style="color:#ff79c6">import</span> Gtk, GdkPixbuf, Gdk
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">class</span> <span style="color:#50fa7b">PictureView</span>(Gtk<span style="color:#ff79c6">.</span>DrawingArea):
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> __init__(self, path, <span style="color:#ff79c6">*</span>args, <span style="color:#ff79c6">**</span>kwargs):
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">super</span>()<span style="color:#ff79c6">.</span>__init__(<span style="color:#ff79c6">*</span>args, <span style="color:#ff79c6">**</span>kwargs)
</span></span><span style="display:flex;"><span>        self<span style="color:#ff79c6">.</span>path <span style="color:#ff79c6">=</span> path
</span></span><span style="display:flex;"><span>        self<span style="color:#ff79c6">.</span>pixbuf <span style="color:#ff79c6">=</span> GdkPixbuf<span style="color:#ff79c6">.</span>Pixbuf<span style="color:#ff79c6">.</span>new_from_file(self<span style="color:#ff79c6">.</span>path)
</span></span><span style="display:flex;"><span>        self<span style="color:#ff79c6">.</span>img_surface <span style="color:#ff79c6">=</span> Gdk<span style="color:#ff79c6">.</span>cairo_surface_create_from_pixbuf(
</span></span><span style="display:flex;"><span>            self<span style="color:#ff79c6">.</span>pixbuf, <span style="color:#bd93f9">1</span>, <span style="color:#ff79c6">None</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_useful_height</span>(self):
</span></span><span style="display:flex;"><span>        aw <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>get_allocated_width()
</span></span><span style="display:flex;"><span>        pw <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>pixbuf<span style="color:#ff79c6">.</span>get_width()
</span></span><span style="display:flex;"><span>        ph <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>pixbuf<span style="color:#ff79c6">.</span>get_height()
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> aw<span style="color:#ff79c6">/</span>pw <span style="color:#ff79c6">*</span> ph
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">get_scale_factor</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> self<span style="color:#ff79c6">.</span>get_allocated_width() <span style="color:#ff79c6">/</span> self<span style="color:#ff79c6">.</span>pixbuf<span style="color:#ff79c6">.</span>get_width()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">do_draw</span>(self, context):
</span></span><span style="display:flex;"><span>        sf <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>get_scale_factor()
</span></span><span style="display:flex;"><span>        context<span style="color:#ff79c6">.</span>scale(sf, sf)
</span></span><span style="display:flex;"><span>        context<span style="color:#ff79c6">.</span>set_source_surface(self<span style="color:#ff79c6">.</span>img_surface, <span style="color:#bd93f9">0</span>, <span style="color:#bd93f9">0</span>)
</span></span><span style="display:flex;"><span>        context<span style="color:#ff79c6">.</span>paint()
</span></span><span style="display:flex;"><span>        height <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>get_useful_height(self<span style="color:#ff79c6">.</span>get_allocated_width())
</span></span><span style="display:flex;"><span>        self<span style="color:#ff79c6">.</span>set_size_request(<span style="color:#ff79c6">-</span><span style="color:#bd93f9">1</span>, height)
</span></span></code></pre></div><p>This code is actually simpler than I imagined, and that&rsquo;s a good thing. Let&rsquo;s see what&rsquo;s going on here.</p>
<p>I&rsquo;m doing all of this in a self contained class I unoriginally called <em>PictureView</em>, of course you can rename it to your liking. It takes a path to a picture as an argument.</p>
<p>I&rsquo;m subclassing <code>Gtk.DrawingArea</code> to be able to draw arbitrary stuff with cairo.</p>
<p>The first thing is creating a base <code>GdkPixbuf.Pixbuf</code> to store the original image, create a cairo surface from that image and then tell the widget what to do inside the <code>do_draw</code> method.</p>
<p>This will in turn find out the size at which it wants to be rendered.</p>
<p>For the width, I want all of it, or in other words all of the allocated width that the widget has.</p>
<p>As for the height, I simply calculate the target height (indicated as <code>allocated_height</code> in the formula below) by solving a simple proportion between the picture width and the allocated width:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-fallback" data-lang="fallback"><span style="display:flex;"><span>pixbuf_width / allocated_width = pixbuf_height / allocated_height
</span></span></code></pre></div><p>Once I have this useful data, I set the widget size request with the new values I found (I leave the width as -1 so that it doesn&rsquo;t change).</p>
<p>Then, I scale the whole cairo context with the <code>scale</code> method, calculating the scale factor as <code>widget_width / pixbuf_width</code>, and finally set the cairo context source to the image surface I created in the constructor.</p>
<p>Oh, and don&rsquo;t forget to call <code>cairo.paint()</code> as well.</p>
<p>All in all this is pretty straight forward, but you need to know what you&rsquo;re doing, and I certainly did not up to about a couple of hour ago.</p>
<p>Hopefully if you need to do this, you will find this blog post and avoid wasting two hours of your time trying to figure this out from sparse C code floating around the internet.</p>
<hr>
<p>As a final note, I&rsquo;m being told that in GTK4 GtkPicture is able to do this, but since I&rsquo;m still stuck with GTK3 (as you probably are as well if you&rsquo;re reading this), this is the best solution I could find.</p>
]]></description>
      
    </item>
    
    
  </channel>
</rss>
